{% extends "base.html" %}

{% block content %}
<div class="detail-header">
    <a href="{{ url_for('index') }}" class="back-link">‚Üê Back</a>
    <button class="edit-habit-btn" onclick="openEditModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        <span>Edit</span>
    </button>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal" onclick="closeModalOnBackdrop(event)">
    <div class="modal-content">
        <h2>Edit Habit</h2>

        <form method="POST" action="{{ url_for('rename_habit_route', habit_id=habit.habit_id) }}">
            <label for="habit_name">Habit Name</label>
            <input
                type="text"
                id="habit_name"
                name="habit_name"
                value="{{ habit.habit_name }}"
                required
                autofocus
            >

            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
            </div>
        </form>

        <div class="delete-section">
            <form method="POST" action="{{ url_for('delete_habit_route', habit_id=habit.habit_id) }}"
                  onsubmit="return confirm('Delete {{ habit.habit_name }}? All historical data will be preserved.')">
                <button type="submit" class="btn btn-delete">Delete Habit</button>
            </form>
        </div>
    </div>
</div>

<script>
function openEditModal() {
    document.getElementById('editModal').style.display = 'flex';
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

function closeModalOnBackdrop(event) {
    if (event.target.id === 'editModal') {
        closeEditModal();
    }
}
</script>

<div class="habit-card">
    <div class="habit-header">
        <div class="habit-name-static">{{ habit.habit_name }}</div>
        <form method="POST" action="{{ url_for('toggle_habit', habit_id=habit.habit_id) }}" style="margin: 0;">
            <input type="hidden" name="next" value="{{ url_for('habit_detail', habit_id=habit.habit_id) }}">
            <input type="checkbox"
                   class="habit-checkbox"
                   {% if habit.completed_today %}checked{% endif %}
                   onchange="this.form.submit()">
        </form>
    </div>

    <div class="habit-body">
        <div class="habit-count-display">
            <span class="count-main">{{ habit.count }}</span>
            <span class="count-suffix">/100</span>
        </div>

        <div class="dot-grid">
            {% for day_completed in habit.history %}
            <div class="dot {% if day_completed %}filled{% endif %}"></div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
